/*! gameoflife 23-05-2016 */
var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},GameOfLifeJs;!function(a){var b=function(){function b(b){this.patternService=new a.PatternService(b),this.ruleService=new a.RuleService(b)}return b.prototype.getPatternService=function(){return this.patternService},b.prototype.getRuleService=function(){return this.ruleService},b}();a.DataManager=b}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b=function(){function a(a){this.url=a.baseurl+"/pattern"}return a.prototype.getPatterns=function(){return $.ajax({type:"GET",url:this.url,contentType:"application/json; charset=utf-8"})},a}();a.PatternService=b}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b=function(){function a(a){this.url=a.baseurl+"/rule"}return a.prototype.getRule=function(){return $.ajax({type:"GET",url:this.url,contentType:"application/json; charset=utf-8"})},a}();a.RuleService=b}(GameOfLifeJs||(GameOfLifeJs={}));var BackBoneEvents=BackBoneEvents||{},GameOfLifeJs;!function(a){var b=function(){function b(b,c,d){this.dataManager=d,_.extend(BackBoneEvents,Backbone.Events);var e={cellCollection:{},width:70,height:70,dataManager:this.dataManager,componentType:"gameboard",container:b},f={dataManager:this.dataManager,patterns:null,componentType:"controlpanel",container:c};a.ComponentFactory.createComponent(e),a.ComponentFactory.createComponent(f)}return b.prototype.getRandomLife=function(){this.randomData=[];for(var a=0;70>a;a++){this.randomData[a]=[];for(var b=0;70>b;b++)this.randomData[a][b]=Math.floor(700*Math.random()+1)%5===0}return this.randomData},b}();a.GameOfLife=b}(GameOfLifeJs||(GameOfLifeJs={})),window.onload=function(){var a=document.getElementById("content"),b=document.getElementById("controls"),c=new GameOfLifeJs.DataManager({baseurl:"http://localhost/GameOfLifeService/api"});new GameOfLifeJs.GameOfLife(a,b,c)};var GameOfLifeJs;!function(a){var b;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.neighbourCells=function(){return[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]]},b.prototype.initialize=function(){},b.prototype.getLiveNeighbours=function(a,b,c){var d=a.get("column"),e=a.get("row"),f=_.filter(this.neighbourCells(),function(a){var c=a[0]+d,f=a[1]+e;if(0>c||0>f||c>this.width-1||f>this.height-1)return!1;var g=this.at(c+f*b);return g?g.get("alive"):!1},this);return f.length},b.prototype.clear=function(){this.each(function(a){a.set("alive",!1)},this)},b.prototype.randomize=function(){this.each(function(a){a.set("alive",!!Math.round(1*Math.random()))})},b.prototype.setParren=function(a,b,c){for(var d=JSON.parse(a.get("data")),e=0;e<d.length;e++)for(var f=0;f<d[0].length;f++){var g=this.findCellByDimention(e,f);g.setAlive(d[e][f])}},b.prototype.findCellByDimention=function(a,b){var c;return this.each(function(d,e){d.column===a&&d.row===b&&(c=d)}),c},b}(Backbone.Collection);a.CellCollection=b}(b=a.Collection||(a.Collection={}))}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b;!function(b){var c=function(b){function c(a){b.call(this,a)}return __extends(c,b),c.prototype.initialize=function(b){var c=this;_.each(b,function(b){c.add(new a.Model.Pattern(b))})},c.prototype.getPattern=function(a){return this.get(a)},c}(Backbone.Collection);b.PatternCollection=c}(b=a.Collection||(a.Collection={}))}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b=function(){function a(){}return a.prototype.initialize=function(a){},a}();a.Component=b}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b=function(){function b(){}return b.createComponent=function(b){switch(b.componentType){case"gameboard":var c=new a.GameBoard;c.initialize(b);break;case"controlpanel":var d=new a.ControlPanel;d.initialize(b)}},b}();a.ComponentFactory=b}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b=function(){function b(){}return b.prototype.initialize=function(b){var c=new a.View.ControlPanelView(b);$(b.container).append(c.render().el)},b}();a.ControlPanel=b}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b=function(){function b(){}return b.prototype.initialize=function(b){var c=new a.View.GameGridView(b);$(b.container).append(c.render().el)},b}();a.GameBoard=b}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b;!function(a){var b=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.prototype.defaults=function(){return{id:"",name:"",data:[]}},b.prototype.initialize=function(){this.get("id")||this.set({id:this.defaults().id}),this.get("name")||this.set({name:this.defaults().name}),this.get("data")||this.set({data:this.defaults().data})},b}(Backbone.Model);a.Pattern=b}(b=a.Model||(a.Model={}))}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b;!function(a){var b=function(a){function b(b){a.call(this),this.survival=b.survival,this.birth=b.birth}return __extends(b,a),b.prototype.defaults=function(){return{survival:[],birth:[]}},b.prototype.initialize=function(){this.get("survival")||this.set({survival:this.defaults().survival}),this.get("birth")||this.set({birth:this.defaults().birth})},b}(Backbone.Model);a.Rule=b}(b=a.Model||(a.Model={}))}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b;!function(a){var b=function(a){function b(b){a.call(this,b),this.column=b.column,this.row=b.row}return __extends(b,a),b.prototype.defaults=function(){return{alive:!1,nextState:!1,column:0,row:0}},b.prototype.initialize=function(){this.get("alive")||this.set({alive:this.defaults().alive}),this.get("column")||this.set({column:this.defaults().column}),this.get("row")||this.set({row:this.defaults().row}),this.get("nextState")||this.set({nextState:this.defaults().nextState}),BackBoneEvents.on("GameGridView:redraw",this.regenerate,this)},b.prototype.applyRule=function(a,b){this.get("alive")?this.set("nextState",this.checkSurvivalStatus(a,b)):this.set("nextState",this.checkBirthStatus(a,b))},b.prototype.clear=function(){this.alive=!1},b.prototype.setAlive=function(a){this.set("alive",a)},b.prototype.regenerate=function(){this.set("alive",this.get("nextState")),this.set("nextState",!1)},b.prototype.checkSurvivalStatus=function(a,b){var c=[];return _.each(a.survival,function(a){b===a&&c.push(!0)}),c.length>0},b.prototype.checkBirthStatus=function(a,b){var c=[];return _.each(a.birth,function(a){b===a&&c.push(!0)}),c.length>0},b}(Backbone.Model);a.Cell=b}(b=a.Model||(a.Model={}))}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b=function(){function a(){}return a.prototype.defaults=function(){},a.prototype.initialize=function(){this.tick=2e3},a.prototype.start=function(){this.timer||(this.timer=window.setInterval(this.onTick,this.tick))},a.prototype.stop=function(){this.timer&&(this.timer=clearInterval(this.timer))},a.prototype.changeSpeed=function(a){this.tick=a,this.timer&&(this.stop(),this.start())},a.prototype.onTick=function(){BackBoneEvents.trigger("Timer:tick")},a}();a.Timer=b}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b;!function(a){var b=function(a){function b(){a.call(this,{tagName:"div"})}return __extends(b,a),b.prototype.initialize=function(){},b.prototype.render=function(){return this.$el.addClass("RowX"),this},b}(Backbone.View);a.CellsRowView=b}(b=a.View||(a.View={}))}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b;!function(a){var b=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.prototype.initialize=function(){this.model.on("change:alive",this.render,this)},b.prototype.render=function(){return this.model.get("alive")?this.$el.addClass("alive"):this.$el.removeClass("alive"),this},b}(Backbone.View);a.CellView=b}(b=a.View||(a.View={}))}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b;!function(b){var c=function(c){function d(a){a||(a={}),a.tagName="div",a.role="form",a.events={"click #btnStart":"onStart","click #btnStop":"onStop"},c.call(this,a)}return __extends(d,c),d.prototype.initialize=function(a){this.dm=a.dataManager,this.options=a,this.template=_.template('<fieldset><div class="form-group"><label>Select Life Pattern</label><div id="selectPattern"></div></div><div class="checkbox"><label><input type="checkbox">Disabled Checkbox</label></div><button type="submit" id="btnStart" class="btn btn-primary">Start</button><button type="submit" id="btnStop" class="btn btn-primary">Stop</button></fieldset>'),BackBoneEvents.on("PatternItemView:patternSelected",this.onPatternSelected,this)},d.prototype.render=function(){var c=this;return this.dm&&this.dm.getPatternService().getPatterns().done(function(d){return c.options.patterns=new a.Collection.PatternCollection(d),c.options.patterns&&c.options.patterns.length>0?(c.patternSelecion=new b.PatternListView({models:c.options.patterns.models}),c.$el.html(c.template()),c.$("#selectPattern").append(c.patternSelecion.render().el),BackBoneEvents.trigger("ControlPanel:patternChange",c.options.patterns.models[0]),c):void 0}).fail(function(a){console.log("pull rule from server failed")}),this},d.prototype.onStart=function(){BackBoneEvents.trigger("ControlPanel:start")},d.prototype.onStop=function(){BackBoneEvents.trigger("ControlPanel:stop")},d.prototype.onPatternSelected=function(a){BackBoneEvents.trigger("ControlPanel:patternChange",a)},d.prototype.clear=function(){BackBoneEvents.trigger("ControlPanel:clear")},d.prototype.randomize=function(){BackBoneEvents.trigger("ControlPanel:randomize")},d}(Backbone.View);b.ControlPanelView=c}(b=a.View||(a.View={}))}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b;!function(b){var c=function(c){function d(a){a||(a={}),a.tagName="div",a.className="gridView",c.call(this,a),this.dm=a.dataManager}return __extends(d,c),d.prototype.initialize=function(b){b&&(this.width=b.width,this.height=b.height),this.collection=this.generateCollection(),this.timer=new a.Timer,BackBoneEvents.on("Timer:tick",this.redrawGridView,this),BackBoneEvents.on("ControlPanel:start",this.start,this),BackBoneEvents.on("ControlPanel:stop",this.stop,this),BackBoneEvents.on("ControlPanel:patternChange",this.applyPattern,this)},d.prototype.render=function(){var c=this;return this.dm&&this.dm.getRuleService().getRule().done(function(d){c.rule=new a.Model.Rule(d);var e=1,f=(new b.CellsRowView).render().el;return c.$el.append(f),c.collection.each(function(a){var c=new b.CellView({model:a,className:"cell"});$(f).append(c.render().el),e%this.width===0&&(f=(new b.CellsRowView).render().el,this.$el.append(f)),e++},c),c}).fail(function(a){console.log("pull rule from server failed")}),this},d.prototype.applyPattern=function(a){this.collection.setParren(a,this.width,this.height),BackBoneEvents.trigger("GameGridView:patternChange")},d.prototype.redrawGridView=function(){this.rule&&this.collection.length>0&&(this.collection.each(function(a){a.applyRule(this.rule,this.collection.getLiveNeighbours(a,this.width,this.height))},this),BackBoneEvents.trigger("GameGridView:redraw"))},d.prototype.clear=function(){this.collection.clear()},d.prototype.randomize=function(){this.collection.randomize()},d.prototype.generateCollection=function(){for(var b=new a.Collection.CellCollection,c=0;c<this.height;c++)for(var d=0;d<this.width;d++)b.add(new a.Model.Cell({column:d,row:c,alive:!1,nextState:!1}));return b},d.prototype.start=function(){this.timer.start()},d.prototype.stop=function(){this.timer.stop()},d}(Backbone.View);b.GameGridView=c}(b=a.View||(a.View={}))}(GameOfLifeJs||(GameOfLifeJs={}));var GameOfLifeJs;!function(a){var b;!function(b){var c=function(a){function b(b){b.tagName="option",b.events={click:"itemClicked"},a.call(this,b),this.options=b}return __extends(b,a),b.prototype.render=function(){return this.$el.attr("value",this.options.model.get("name")),this.$el.append(this.model.get("name")),this},b.prototype.itemClicked=function(){BackBoneEvents.trigger("PatternItemView:patternSelected",this.model)},b}(Backbone.View);b.PatternItemView=c;var d=function(b){function d(a){a.tagName="select",a.id="patternDropDown",a.className="form-control",b.call(this,a)}return __extends(d,b),d.prototype.initialize=function(b){this.collection=new a.Collection.PatternCollection(b.models)},d.prototype.render=function(){return _.each(this.collection.models,function(a){this.$el.append(new c({model:a}).render().el)},this),this},d}(Backbone.View);b.PatternListView=d}(b=a.View||(a.View={}))}(GameOfLifeJs||(GameOfLifeJs={}));